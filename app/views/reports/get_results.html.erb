<div class="col-md-7 col-md-offset-3 main">
  <% provide(:title, "Results for #{@report.id} Report")%>
  <center><h1>Result of <%= @report.name %></h1></center>
  <% BusinessesReportType.where("report_type_id = ?", @report.report_type_id).each do |brt| %>
    <h2><%= Business.find(brt.business_id).name %></h2>
    <% EmployeesReportType.where("report_type_id = ?", @report.report_type_id).each do |ert| %>
      <table class="table-bordered">
        <thead>
          <tr>
            <th><%= Employee.find(ert.employee_id).display_name %></th>
            <th>
              <% sum = 0 %>
              <% ReportResult.where("report_id = ?", @report.id).where("employee_id = ?", ert.employee_id).each  { |rr| sum += rr.calculated } %>
              <b><font color="#8E24DC"><%= sum %></b></font> h
            </th>
            <th colspan="3"></th>
          </tr>
        </thead>

        <tbody>
          <% ReportResult.order(:issue_id).where("report_id = ?", @report.id).where("employee_id = ?", ert.employee_id).where("calculated != ?", 0).each  do |rr| %>
            <tr>
              <td><% issue = Issue.find(rr.issue_id) %>
              <%= issue.issue_key %> - <%= issue.title %></td>
              <td><b><%= rr.calculated %></b> h</td>
              <td><% ComponentsIssue.where("issue_id = ?", issue.id).each do |c| %>
                <%= Component.find(c.component_id).name %><br>
              <% end %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <br>
    <% end %>
  <% end %>
</div>
<%= link_to 'Back', reports_path %>